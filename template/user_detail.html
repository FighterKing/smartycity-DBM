{% extends "template/base.html" %}

<!-- HEAD**************************************** -->
<!-- TITLE-->
{% block title %}User Details{% endblock %}

<!-- EXTRAHEAD-->
{% block extrahead %}
<script>
    $(document).ready(function(){
//        setUserBasicFormAction()
        setUserType()
        setRoleTypeId()
        setRolePositionId()

        $("#btn_update_user_basic").on("click", function(){
        	$("#formUserBasic").submit(function(e){
	            putUserBasicInfo()
                e.preventDefault(); //STOP default action
//                e.unbind(); //unbind. to stop multiple form submit.
	            return false //为了不刷新页面,返回false
	        })
        })
        
        function putUserBasicInfo(){
            $.ajax({
                type: "PUT",
                url: "/admin/user/" + getUserId(),
                //contentType:'application/x-www-form-urlencoded; charset=UTF-8',
                data: {"password":$("#input_password").val(),
                    "email":$("#input_email").val(),
                    "name":$("#input_name").val(),
                    "identity_number":$("#input_identity_number").val(),
                    "card_id":$("#input_card_id").val(),
                    "user_type_id":$("#select_user_type").val(),
                    "image":'default.jpg'},
                success: function () {
                    alert("Update success.")
                }
            })
        }
        function setRolePositionId(){
            var role_position_id = $("#select_role_position").attr("rolePositionVal")
            $("#select_role_position").val(role_position_id)
        }
        function setRoleTypeId(){
            var role_type_id = $("#select_role").attr("roleTypeVal")
            $("#select_role").val(role_type_id)
        }
        function setUserType(){
            var optionText = $("#select_user_type").attr("optionText")
            switch(optionText){
                case "management":
                    $("#select_user_type").val("1")
                    break
                case "service":
                    $("#select_user_type").val("2")
                    break
                case "resident":
                    $("#select_user_type").val("3")
                    break
                default :
                    break
            }
        }
        function setUserBasicFormAction() {
            document.formUserBasic.action = "/admin/user/" + getUserId()
            console.log(document.formUserBasic.action)
        }
        function getUserId(){
            var url = window.location.href
            var strs = url.toString().split("/")
            return strs[strs.length - 1]
        }
    })
</script>
{% endblock %}

<!-- BODY**************************************** -->
<!-- NAVIGATION -->

<!-- CONTENT -->
    <!--SIDE_BAR-->

    <!--CONTENT_CONTAINER-->
    {% block content_container %}
<h1 class="page-header">User Details</h1>

{% if user %}
<div class="row placeholders">
    <div class="col-xs-5 col-sm-5 placeholder">
        <!--Basic Infomation-->
        <h3 class="sub-header text-left">Basic Infomation</h3>
        {% include "template/form_user_basic.html" %}
        <!--Real Name Card-->
        <h3 class="sub-header text-left">Name Card</h3>
        {% include "template/form_card_realname.html" %}
    </div>

    <div class="col-xs-5 col-xs-offset-1 col-sm-5 col-sm-offset-1 placeholder">
        <!--Resident Information-->
        <h3 class="sub-header text-left">Resident Information</h3>
        {% include "template/form_resident.html" %}
    </div>
</div><!--row-->

<div class="row placeholders">
    <div class="col-xs-5 col-sm-5 placeholder">
        <!--Net Card-->
        <h3 class="sub-header text-left">Net Card</h3>
        {% include "template/form_card_net.html" %}
        <!--Reside Card-->
        <h3 class="sub-header text-left">Reside Card</h3>
        {% include "template/form_card_reside.html" %}
    </div>

    <div class="col-xs-5 col-xs-offset-1 col-sm-5 col-sm-offset-1 placeholder">
        <!--Party Card-->
        <h3 class="sub-header text-left">Party Card</h3>
        {% include "template/form_card_party.html" %}
    </div>
</div><!--row-->

<div class="row placeholders">
    <div class="col-xs-5 col-sm-5 placeholder">
        <!--Role Information-->
        <h3 class="sub-header text-left">Role Information</h3>
        {% include "template/form_role.html" %}
    </div>

    <div class="col-xs-5 col-xs-offset-1 col-sm-5 col-sm-offset-1 placeholder">
    </div>
</div><!--row-->
{% endif %}
    {% endblock content_container %}

<!-- FOOTER -->

<!-- EXTRA_STYLE -->
{% block extra_style %}
{{ super() }}
<style>
    .form-horizontal img{
        max-height: 64px;max-width: 64px;
    }
</style>
{% endblock %}